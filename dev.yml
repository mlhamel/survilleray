name: survilleray
env:
    DATABASE_URL: "postgres://postgres@survilleray.railgun:5432/survilleray_development"
up:
  - homebrew:
    - openssl
    - golangci/tap/golangci-lint
  - go:
      version: 1.12
      modules: true
  - railgun
  - custom:
      name: Create PostgreSQL database
      met?: psql --username=postgres --host=survilleray.railgun -lqt | cut -d \| -f 1 | grep -qw survilleray_development
      meet: createdb --username=postgres --host=survilleray.railgun survilleray_development
  - custom:
      name: Build migration tool
      met?: bin/survilleray-migrate
      meet: go build -o bin/survilleray-migrate cmd/migrate/main.go
  - custom:
      name: Build cron
      met?: bin/survilleray-cron
      meet: go build -o bin/survilleray-cron cmd/cron/main.go
  - custom:
      name: Load dependencies
      met?: go mod tidy
      meet: go mod tidy
commands:
  test: go test -cover -race ./...
  lint: golangci-lint run
  survilleray: go run ./cmd/survilleray
  db:migrate:
    desc: "Run all migrations"
    run: bin/migrate


